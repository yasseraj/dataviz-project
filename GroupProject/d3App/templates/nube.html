{% extends 'base.html' %}
{% load staticfiles %}

{% block css_or_js %}
        <script src="{% static 'js/d3.layout.cloud.js' %}"></script>
{% endblock css_or_js %}
{% block scripts %}
        <script>               
            var words = [];
            var size = [700,400];
            var length = 95;

            var colors_list = [];
            for(var i=0; i<length;i++){
                var c = "#"+((1<<24)*Math.random()|0).toString(16);
                colors_list.push(c);
            }
            var blackWords= [
              "@",
              ",",
              ".",
              "?",
              "??",
              "???",
              "????",
              "?????"
            ];
            
            d3.json("{% url "nube_palabras" %}", function(error, data) {
                datasetPalabras = data;
                datasetPalabras.forEach(function(element){
                    var text = element.keyword;
                    if(! blackWords.includes(text)){
                        var size = parseInt(element.repeats*100/9721);
                        var elementAux = {text,size};
                        words.push(elementAux); 
                    }                   
                 });
                 words = words.slice(0,90);
                 d3.layout.cloud().size([size[0],size[1]])
                    .words(words)
                    .rotate(0)
                    .fontSize(function(d) { return d.size; })
                    .on("end", draw)
                    .start();
            });
            
            function draw(words) {
                d3.select("body").append("svg")
                        .attr("width", size[0])
                        .attr("height", size[1])
                        .attr("class", "wordcloud")
                        .append("g")
                        .attr("transform", "translate(320,200)")
                        .selectAll("text")
                        .data(words)
                        .enter().append("text")
                        .style("font-size", function(d) { return d.size + "px"; })
                        .style("fill", function(d,i) {
                            return colors_list[i];
                        })
                        .attr("transform", function(d) {
                            return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
                        })
                        .text(function(d) {
                            return d.text;
                        });
            }           
        </script>
{% endblock scripts %}